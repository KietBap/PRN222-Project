@page
@model PRN222.RoomBooking.UserRazor.Pages.Rooms.DetailsModel

@{
    // Get the current date as DateOnly
    var currentDate = DateOnly.FromDateTime(DateTime.Today);
}

<div class="container mt-4">
    <h2 class="text-primary text-center mb-4">Room Details</h2>

    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">Room Information</h4>
        </div>
        <div class="card-body">
            <dl class="row mb-0">
                <dt class="col-sm-3 font-weight-bold">
                    @Html.DisplayNameFor(model => model.Room.RoomName)
                </dt>
                <dd class="col-sm-9">
                    @Html.DisplayFor(model => model.Room.RoomName)
                </dd>
                <dt class="col-sm-3 font-weight-bold">
                    @Html.DisplayNameFor(model => model.Room.Capacity)
                </dt>
                <dd class="col-sm-9">
                    @Html.DisplayFor(model => model.Room.Capacity)
                </dd>
                <dt class="col-sm-3 font-weight-bold">
                    @Html.DisplayNameFor(model => model.Room.Status)
                </dt>
                <dd class="col-sm-9">
                    <span class="badge @(Model.Room.Status == "Available" ? "bg-success" : "bg-warning")">
                        @Html.DisplayFor(model => model.Room.Status)
                    </span>
                </dd>
                <dt class="col-sm-3 font-weight-bold">
                    @Html.DisplayNameFor(model => model.Room.Campus)
                </dt>
                <dd class="col-sm-9">
                    @Html.DisplayFor(model => model.Room.Campus.CampusName)
                </dd>
            </dl>
        </div>
    </div>

    <!-- Room Slots Section -->
    @if (Model.Room.RoomSlots != null && Model.Room.RoomSlots.Any(slot => slot.Date.HasValue && slot.Date.Value >= currentDate))
    {
        <div class="card shadow-sm mt-4">
            <div class="card-header bg-info text-white">
                <h4 class="mb-0">Available Room Slots (Today and Future)</h4>
            </div>
            <div class="card-body">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>Slot ID</th>
                            <th>Date</th>
                            <th>Start Time</th>
                            <th>End Time</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var slot in Model.Room.RoomSlots
                       .Where(slot => slot.Date.HasValue && slot.Date.Value >= currentDate)
                       .OrderBy(slot => slot.Date)
                       .ThenBy(slot => slot.StartTime))
                        {
                            <tr>
                                <td>@slot.RoomSlotId</td>
                                <td>@slot.Date.Value.ToString("dd/MM/yyyy")</td>
                                <td>@(slot.StartTime.HasValue ? slot.StartTime.Value.ToString("HH:mm") : "N/A")</td>
                                <td>@(slot.EndTime.HasValue ? slot.EndTime.Value.ToString("HH:mm") : "N/A")</td>
                                <td>
                                    <span class="badge @(slot.Status == "Available" ? "bg-success" : "bg-warning")">
                                        @slot.Status
                                    </span>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
    else
    {
        <div class="card shadow-sm mt-4">
            <div class="card-header bg-warning text-white">
                <h4 class="mb-0">No Available Room Slots for Today or Future</h4>
            </div>
            <div class="card-body">
                <p class="text-muted">There are no room slots available for today (@currentDate.ToString("dd/MM/yyyy")) or future dates.</p>
            </div>
        </div>
    }

    <div class="mt-4 text-center">
        <a asp-page="./Index" class="btn btn-primary">
            <i class="fas fa-arrow-left"></i> Back to List
        </a>
    </div>
</div>

@section Scripts {
    <!-- Add Font Awesome for icons if not already included -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
}